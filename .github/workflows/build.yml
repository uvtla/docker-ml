name: Docker Compose CI

on:
  pull_request:
    branches:
      - master

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Build and run with Docker Compose
      run: |
        docker-compose build
        docker-compose up -d

    - name: Check running containers
      run: |
        if ! docker ps --format '{{.Names}}' | grep -q '^frontend$'; then
          echo "Container 'frontend' is not running!"
          exit 1
        fi

        if ! docker ps --format '{{.Names}}' | grep -q '^image_recognition$'; then
          echo "Container 'image_recognition' is not running!"
          exit 1
        fi

        echo "Both 'frontend' and 'image_recognition' containers are running."

    - name: Cleanup
      if: always()
      run: docker-compose down
